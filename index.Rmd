---
title: "Tarea 02 - Graficación y Tidyverse"
author: "Marcelo Cubero Sibaja"
date: "1/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Graficación y Tidyverse

```{r carga-paquetes, include=FALSE}
# dplyr
library(dplyr) 
# Carga de graphics
library(graphics)

# Carga de ggplot2
library(ggplot2)

# Carga de hrbrthemes
library(hrbrthemes)

# Carga de plotly
library(plotly)

# Carga de dplyr
library(dplyr)

```
### Datos
```{r carga-datos}
# Carga de datos desde un archivo CSV
rios <-
  read.csv(file = 'https://raw.githubusercontent.com/tpb728O-programaciongeoespacialr/2021ii/main/datos/hidrologia/fdc/fdc.csv')
           
# Carga de datos desde un archivo CSV
covid <- 
  read.csv(
    file='https://raw.githubusercontent.com/tpb728O-programaciongeoespacialr/2021ii/main/datos/minsalud/covid/ultimafecha_CSV_GENERAL.csv', 
    sep = ","
  )           

```

### Gráfico de barras apiladas que muestre el caudal de los ríos Pandora y Bananito por cada uno de los 12 meses del año.

```{r d1}
  grafico_rios <-
  rios %>%
  rename(fecha = Tiempo,
         pandora = Pandora.mm..637km2.,
         banano = Banano.mm..90km2.) %>%
  mutate(fecha = as.Date(fecha, format = "%m/%d/%Y")) %>%
  group_by(mes = format(fecha,"%m")) %>%
  summarise(p_mes= sum(pandora), b_mes= sum(banano))

```


```{r}
ggplot() + geom_col(
  data = grafico_rios,
  aes(x = mes, y = b_mes, fill = "Río Bananito"),
  width = 0.7,
  position = "stack"
) +
  geom_col(
    data = grafico_rios,
    aes(x = mes, y =  p_mes, fill = "Río Pandora"),
    width = 0.45,
    position = "stack"
  )  +
  ggtitle("Suma del caudal de los ríos Pandora y Bananito, por mes.") +
  xlab("Mes del año") +
  ylab("Suma de Caudal ") +
  theme(
    legend.box      = "horizontal",
    legend.key      = element_blank(),
    legend.title    = element_blank(),
    legend.position = "top"
  )

```


###  Histograma que muestre la distribución de los casos nuevos de covid en Costa Rica





```{r d2}
covid_g2 <-
  covid %>%
  select(FECHA, nue_posi) %>%
  rename(fecha = FECHA, positivos_nuevos = nue_posi) %>%
  mutate(fecha = as.Date(fecha, format = "%d/%m/%Y"))
 

```
```{r g2}
ggplot(covid_g2, aes(x= fecha, y = positivos_nuevos)) +
  geom_histogram(stat='identity', color= "lightsalmon") +
  ggtitle("Distribución de los casos nuevos de covid en Costa Rica") +
  xlab("Fecha") +
  ylab("Cantidad de casos") +
  theme() 
```

###  Gráfico de barras agrupadas que muestre la cantidad de hombres y mujeres fallecidos por covid en Costa Rica por cada uno de los 12 meses del año. 

```{r d3}
covid_g3 <-
  covid %>%
  select(FECHA, hom_fall, muj_fall) %>%
  rename(fecha = FECHA, h_fallecidos = hom_fall, m_fallecidos = muj_fall) %>%
  mutate(fecha = as.Date(fecha, format = "%d/%m/%Y")) %>%
  group_by(mes = format(fecha,"%m")) %>%
  summarise(sum_h= sum(h_fallecidos), sum_m= sum(m_fallecidos))
  

```



```{r}
covid_h <-
  covid %>%
  select(FECHA, hom_fall) %>%
  rename(fecha = FECHA, h_fallecidos = hom_fall) %>%
  mutate(fecha = as.Date(fecha, format = "%d/%m/%Y")) %>%
  group_by(mes = format(fecha,"%m")) %>%
  summarise(sum_h= sum(h_fallecidos))

covid_m <-
  covid %>%
  select(FECHA, muj_fall) %>%
  rename(fecha = FECHA, m_fallecidos = muj_fall) %>%
  mutate(fecha = as.Date(fecha, format = "%d/%m/%Y")) %>%
  group_by(mes = format(fecha,"%m")) %>%
  summarise(sum_m= sum(m_fallecidos))



```

```{r}

  
ggplot() +
  geom_col(data= covid_h, aes( x=mes, y= sum_h, fill= "Hombres"), width = 0.45,
           position = position_nudge(x = -0.225)) +
  geom_col(data= covid_m, aes( x=mes, y= sum_m, fill="Mujeres"), width = 0.45,
           position = position_nudge(x = 0.225)) + theme(legend.box      = "horizontal",
    legend.key      = element_blank(),
    legend.title    = element_blank(),
    legend.position = "right")  +
  ggtitle("Suma de fallecidos por Covid-19, de hombres y mujeres, por mes.") +
  xlab("Mes del año") +
  ylab("Suma de fallecidos ")

```





















